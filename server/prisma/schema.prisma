generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  role         String   @default("OPERATOR")
  createdAt    DateTime @default(now())
  logs         Log[]
}

model Car {
  id           String        @id @default(cuid())
  brand        String
  model        String
  trim         String?
  year         Int?
  pricePerHour Float
  pricePerDay  Float?
  bodyStyle    String?
  transmission String?
  fuel         String?
  seats        Int?
  images       String?
  type         String?
  status       String        @default("AVAILABLE")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  params       CarParamValue[]
  reservations Reservation[]
}

model CarParamDef {
  id      String    @id @default(cuid())
  name    String    @unique
  type    String
  options String?
  unit    String?
  values  CarParamValue[]
}

model CarParamValue {
  id        String      @id @default(cuid())
  car       Car         @relation(fields: [carId], references: [id], onDelete: Cascade)
  carId     String
  param     CarParamDef @relation(fields: [paramId], references: [id], onDelete: Cascade)
  paramId   String
  valueText String?
  valueNum  Float?
  valueEnum String?
}

model Reservation {
  id         String             @id @default(cuid())
  car        Car                @relation(fields: [carId], references: [id], onDelete: Cascade)
  carId      String
  from       DateTime
  to         DateTime
  pickPlace  String?
  dropPlace  String?
  driverName String?
  driverPhone String?
  driverEmail String?
  driverLicense String?
  driverBirth   DateTime?
  driverAddress String?
  invoiceType   String?
  invoiceName   String?
  invoiceNum    String?
  invoiceAddr   String?
  invoiceEmail  String?
  status     String             @default("PENDING")
  total      Float? 
  createdAt  DateTime           @default(now())
  invoice    Invoice?
}

model Invoice {
  id            String       @id @default(cuid())
  reservation   Reservation  @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  reservationId String       @unique
  number        String       @unique
  total         Float
  issuedAt      DateTime     @default(now())
  paid          Boolean      @default(false)
}

model Log {
  id        String   @id @default(cuid())
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  action    String
  meta      String?
  createdAt DateTime @default(now())
}

model Location {
  id        String   @id @default(cuid())
  label     String   @unique
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model CompanyInfo {
  id        String   @id @default(cuid())
  name      String
  eik       String   // ЕИК/БУЛСТАТ
  vat       String?  // ДДС № (ако има)
  address   String
  city      String
  country   String   @default("България")
  mol       String?  // МОЛ
  email     String?
  phone     String?
  bank      String?
  iban      String?
  bic       String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


