generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  role         String   @default("OPERATOR")
  createdAt    DateTime @default(now())
  logs         Log[]
}

model Car {
  id           String        @id @default(cuid())
  brand        String
  model        String
  trim         String?
  year         Int?
  pricePerHour Float
  pricePerDay  Float?
  bodyStyle    String?
  transmission String?
  fuel         String?
  seats        Int?
  images       String?
  type         String?
  status       String        @default("AVAILABLE")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  params       CarParamValue[]
  reservations Reservation[]
}

model CarParamDef {
  id      String    @id @default(cuid())
  name    String    @unique
  type    String
  options String?
  unit    String?
  values  CarParamValue[]
}

model CarParamValue {
  id        String      @id @default(cuid())
  car       Car         @relation(fields: [carId], references: [id], onDelete: Cascade)
  carId     String
  param     CarParamDef @relation(fields: [paramId], references: [id], onDelete: Cascade)
  paramId   String
  valueText String?
  valueNum  Float?
  valueEnum String?
}

model Reservation {
  id         String             @id @default(cuid())
  seq        Int                @default(0)
  car        Car                @relation(fields: [carId], references: [id], onDelete: Cascade)
  carId      String
  from       DateTime
  to         DateTime
  pickPlace  String?
  dropPlace  String?
  driverName String?
  driverPhone String?
  driverEmail String?
  driverLicense String?
  driverBirth   DateTime?
  driverAddress String?
  invoiceType   String?
  invoiceName   String?
  invoiceNum    String?
  invoiceEgn    String?
  invoiceVat    String?
  invoiceMol    String?
  invoiceBank   String?
  invoiceIban   String?
  invoiceBic    String?
  invoiceAddr   String?
  invoiceEmail  String?
  status     String             @default("REQUESTED")
  total      Float?
  ratePerDay Float?
  currency   String   @default("EUR")
  createdAt  DateTime           @default(now())
  invoices   Invoice[]
}

model Invoice {
  id              String       @id @default(cuid())
  reservation     Reservation  @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  reservationId   String
  type            String
  number          String?      @unique
  issueDate       DateTime     @default(now())
  dueDate         DateTime?
  currency        String       @default("EUR")
  paymentMethod   String?
  paymentTerms    String?
  status          String       @default("DRAFT")
  notes           String?
  supplierName    String
  supplierEik     String
  supplierVat     String?
  supplierAddr    String
  supplierMol     String?
  supplierEmail   String?
  supplierPhone   String?
  supplierBank    String?
  supplierIban    String?
  supplierBic     String?
  buyerType       String?
  buyerName       String?
  buyerEik        String?
  buyerVat        String?
  buyerEgn        String?
  buyerMol        String?
  buyerAddr       String?
  buyerEmail      String?
  buyerBank       String?
  buyerIban       String?
  buyerBic        String?
  items           String?
  subtotal        Float?
  vatAmount       Float?
  total           Float?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model Log {
  id        String   @id @default(cuid())
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  action    String
  meta      String?
  createdAt DateTime @default(now())
}

model Location {
  id        String   @id @default(cuid())
  label     String   @unique
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model CompanyInfo {
  id        String   @id @default(cuid())
  name      String
  eik       String
  vat       String?
  address   String
  city      String
  country   String   @default("България")
  mol       String?
  email     String?
  phone     String?
  bank      String?
  iban      String?
  bic       String?
  proStart  Int      @default(1)
  invStart  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Policy {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  content   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
